<!--pages/detail/detail.wxml-->
<topbar bgColor="bg-gradual-blue" isBack="{{true}}">
  <view slot="backText">返回</view>
  <view slot="content">文章详情</view>
</topbar>
<view class="header-banner">
  <image class='header-image' src='{{detail.meta.thumbnail?detail.meta.thumbnail:"/images/detail_default.png"}}'
    mode="widthFix"></image>
</view>
<import src="../../wxParse/wxParse.wxml" />
<view class="post-detail">
  <view class="article-info" wx:if="{{detail}}">
    <text class="title">{{detail.title.rendered}}</text>
    <view class="meta">
      <text class="category">{{detail.author.name}}</text>
      <text class="cuIcon-qrcode"></text>
      <text class="category">{{detail.category[0].name}}</text>
      <text class="cuIcon-time"></text>
      <text class="time">{{detail.date}}</text>
    </view>
  </view>
  <view class="article-info skeleton" wx:else>
    <view class="title"></view>
    <view class="meta">
      <image class="avator" src="{{detail.author.avatar}}"></image>
      <text class="category"></text>
      <i></i>
      <text class="time"></text>
    </view>
  </view>
  <view id="entry-content" wx:if="{{article.nodes}}" class="entry-content clearfix">
    <template is="wxParse" data="{{wxParseData:article.nodes}}" />
  </view>
  <view id="entry-content" wx:else class="entry-content skeleton clearfix">
    <view class="skeleton-content">
      <view class="c1"></view>
      <view class="c2"></view>
    </view>
  </view>
  <view class="advert" wx:if="{{advert.type === 'unit'}}">
    <ad unit-id="{{advert.code}}"></ad>
  </view>
  <view class="topic-title-wrapper" id="comment">
    <view class="topic-title">话题讨论</view>
    <view class="onlooker-amount relative">
      <text>邀请好友讨论 </text>
      <text class="onlooker-arrow">>></text>
      <button open-type='share' class="userLogin"></button>
    </view>
  </view>
  <view class="commentdata">
    <view class="listnodata" wx:if="{{comments.length === 0}}">
      <image class="nodataimg" lazyLoad="false" mode="aspectFit|aspectFill|widthFix" src="../../images/message.png">
      </image>
      <view class="nodatatext">
        <text decode="{{true}}" space="{{true}}">&nbsp;&nbsp;&nbsp;</text>还没有评论，快来抢沙发吧！
      </view>
    </view>
    <view class="comment-reply">
      <view class="comment-reply-item" bindtap="replyComment" id="{{detail.id}}" data-parent="{{item.id || 0}}"
        data-reply="{{item.author.name}}" data-formId="{{item.formId}}" wx:for="{{comments}}" wx:for-item="item"
        wx:key="{{id}}">
        <view class="comment-header">
          <view class="comment-header-left">
            <image class="comment-avatar" src="{{item.author.avatar}}"></image>
            <view class="comment-user-date">
              <text>{{item.author.name}}</text>
              <text>{{item.date}}</text>
            </view>
          </view>
          <view class="comment-header-right">
            <text></text>
          </view>
        </view>
        <view class="comment-content" bindtap="replyComment" data-id="{{item.id}}" data-reply="{{item.author.name}}"
          data-parent="{{item.id?item.id:0}}" data-userid="{{item.userid}}" data-formId="{{item.formId}}"
          data-commentdate="{{item.date}}">
          <text bindtap="replay" data-id="{{item.id}}" data-name="{{item.author_name}}" data-userid="{{item.userid}}"
            data-formId="{{item.formId}}" data-commentdate="{{item.date}}"></text> {{item.content}}
          <view class="{{item.images.length==1?'images-list':'image-list'}}">
            <image mode="widthFix" data-url="{{image}}" data-urls="{{item.images}}" catchtap='openimage'
              class="comment-image" src="{{image}}" wx:for="{{item.images}}" wx:for-item="image" wx:key="key"></image>
          </view>
        </view>
        <!-- 一级回复 -->
        <view class="replay-content" wx:for="{{item.reply}}" wx:key="itemid1" wx:for-index="idx" wx:for-item="item1">
          <view class="replay-user" catchtap="replyComment" data-id="{{item1.id}}" data-reply="{{item1.author.name}}"
            data-parent="{{item1.id?item1.id:0}}" data-userid="{{item1.userid}}" data-formId="{{item1.formId}}"
            data-commentdate="{{item1.date}}">
            <text class="font-weight-blod"> {{item1.author.name}} </text>:{{item1.content}}
          </view>
          <!-- 二级回复 -->
          <view wx:for="{{item1.reply}}" wx:key="itemid2" wx:for-index="idx" wx:for-item="item2">
            <view class="replay-user" catchtap="replyComment" data-id="{{item2.id}}" data-reply="{{item2.author.name}}"
              data-userid="{{item2.userid}}" data-formId="{{item2.formId}}" data-commentdate="{{item2.date}}">
              <text class="font-weight-blod"> {{item2.author.name}} </text> 回复 {{item1.author.name}}:{{item2.content}}
            </view>
            <!-- 三级回复 -->
            <view wx:for="{{item2.reply}}" wx:key="itemid3" wx:for-index="idx" wx:for-item="item3">
              <view class="replay-user" catchtap="replyComment" data-id="{{item3.id}}"
                data-reply="{{item3.author.name}}" data-userid="{{item3.userid}}" data-formId="{{item3.formId}}"
                data-commentdate="{{item3.date}}">
                <text class="font-weight-blod"> {{item3.author.name}} </text> 回复
                {{item2.author.name}}:{{item3.content}}
              </view>
              <!-- 四级回复 -->
              <view wx:for="{{item3.reply}}" wx:key="itemid4" wx:for-index="idx" wx:for-item="item4">
                <view class="replay-user">
                  <text class="font-weight-blod"> {{item4.author.name}} </text> 回复
                  {{item3.author.name}}:{{item4.content}}
                </view>
              </view>
              <!-- 四级回复 -->
            </view>
            <!-- 三级回复  -->
          </view>
          <!-- 二级回复 -->
        </view>
        <!-- 一级回复  -->
        <view class="comment-footer">
          <view class="comment-footer-inner"></view>
        </view>
      </view>
    </view>
  </view>

  <view class="bottom">
    <form catchsubmit="formSubmit" report-submit="true" wx:if="{{!showTextarea}}">
      <view class="bottom-bar {{isIphoneX?'bottom-bar-iphonex':''}} {{newsItem.forbidcomment?'forbid-comment':''}}">
        <image bindtap="bindBack" class="bottom-btn bottom-back" src="../../images/back.png"></image>
        <view class="bottom-btn bottom-text relative width-260rpx">
          <text>{{placeholder}}</text>
          <button wx:if="{{!user}}" class="userLogin" bindgetuserinfo="getProfile" openType="getUserInfo"></button>
          <button wx:else class="userLogin" bindtap="tapcomment"></button>
        </view>
        <view class="bottom-btn bottom-comment-container relative">
          <image class="bottom-comment"
            src="{{detail.isfav ? '../../images/collected.png' : '../../images/collect.png'}}">
          </image>
          <button wx:if="{{!user}}" class="userLogin" bindgetuserinfo="getProfile" openType="getUserInfo"></button>
          <button wx:else class="userLogin" bindtap="bindFavTap" id="{{detail.id}}"></button>
        </view>
        <view class="bottom-btn bottom-comment-container">
          <image class="bottom-btn bottom-fav"
            src="{{detail.islike ? '../../images/liked.png' : '../../images/like.png'}}">
          </image>
          <button wx:if="{{!user}}" class="userLogin" bindgetuserinfo="getProfile" openType="getUserInfo"></button>
          <button wx:else class="userLogin" bindtap="bindLikeTap" id="{{detail.id}}"></button>
        </view>
        <button bindtap="shareClick" class="bottom-btn bottom-share bottom-fav btn-clear-style" plain="true">
          <image src="../../images/share.png"></image>
        </button>
      </view>
    </form>
  </view>

  <view class="zan-actionsheet {{isIphoneX?'bottom-bar-iphonex':''}} {{shareshow?'zan-actionsheet--show':''}}">
    <view catchtap="_handleZanActionsheetMaskClick" class="zan-actionsheet__mask"
      data-close-on-click-overlay="{{closeOnClickOverlay}}" data-component-id="{{componentId}}"></view>
    <view class="zan-actionsheet__container">
      <button catchtap="downloadPrefix" class="zan-btn zan-actionsheet__btn">
        <image class="down-icon" mode="aspectFit" src="../../images/down.svg"></image>
        <text>分享海报图</text>
      </button>
      <button open-type="share" class="zan-btn zan-actionsheet__btn">
        <image class="down-icon" mode="aspectFit" src="../../images/wechat.svg"></image>
        <text>分享给朋友</text>
      </button>
    </view>
  </view>

  <view capture-catch:touchmove class="textareacontent" wx:if="{{showTextarea}}">
    <form catchsubmit="addComment">
      <view class="textheaders">
        <view bindtap="closeCommentary" class="cancel">取消</view>
        <button wx:if="{{!user}}" class="nopublish" bindgetuserinfo="getProfile" openType="getUserInfo">登录</button>
        <button wx:else bindtap="addComment" class="publish">发布</button>
      </view>
      <view class="textareaBox" wx:if="{{showTextarea}}">
        <view class="textareaInput" wx:if="{{!focus}}">{{content}}</view>
        <textarea autoFocus="true" name="inputComment" bindinput="bindInputContent" bindblur="onReplyBlur"
          bindfocus="onRepleyFocus" class="textareaInput {{focus?'':'hide'}}" fixed="true" focus="{{focus}}"
          maxlength="1000" placeholder="{{placeholder}}" showConfirmBar="{{false}}" class="height-286rpx"
          value="{{content}}"></textarea>
        <view class="textNum">{{textNum}}/1000</view>
      </view>
    </form>
  </view>
  <view bindtap="closeCommentary" class="pagemake" wx:if="{{showTextarea}}"></view>
</view>
<view class="canvas">
  <canvas canvas-id="prefix" class="canvas-prefix"></canvas>
</view>